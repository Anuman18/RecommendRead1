{% extends "layout.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="jumbotron">
  <h1 class="display-4">Welcome to RecommRead</h1>
  <p class="lead">Discover, read, and bookmark your favorite stories.</p>
  <hr class="my-4">
  <p>Share your own stories or explore what others have written.</p>
  <div class="user-logged-out">
    <a class="btn btn-primary btn-lg" href="/signup" role="button">Get Started</a>
  </div>
</div>

<div class="row mt-5">
  <div class="col-md-12">
    <h2 class="mb-4">Recent Stories</h2>
    <div id="recent-stories-container" class="row">
      <div class="text-center">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    fetchRecentStories();
  });

  function fetchRecentStories() {
    fetch('/api/stories?per_page=6')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById('recent-stories-container');
        container.innerHTML = '';
        
        if (data.stories.length === 0) {
          container.innerHTML = '<div class="col-12"><p class="text-center">No stories available yet. Be the first to create one!</p></div>';
          return;
        }
        
        data.stories.forEach(story => {
          const storyCard = createStoryCard(story);
          container.appendChild(storyCard);
        });
      })
      .catch(error => {
        console.error('Error fetching stories:', error);
        showAlert('Failed to load recent stories', 'danger');
      });
  }

  function createStoryCard(story) {
    const col = document.createElement('div');
    col.className = 'col-md-4 mb-4';
    
    const card = document.createElement('div');
    card.className = 'card h-100 story-card';
    
    const cardBody = document.createElement('div');
    cardBody.className = 'card-body';
    
    const title = document.createElement('h5');
    title.className = 'card-title';
    title.textContent = story.title;
    
    const author = document.createElement('h6');
    author.className = 'card-subtitle mb-2 text-muted';
    author.textContent = `By ${story.author_username}`;
    
    const content = document.createElement('p');
    content.className = 'card-text';
    content.textContent = story.content.length > 100 ? 
      story.content.substring(0, 100) + '...' : 
      story.content;
    
    const footer = document.createElement('div');
    footer.className = 'card-footer d-flex justify-content-between align-items-center';
    
    const date = document.createElement('small');
    date.className = 'text-muted';
    date.textContent = new Date(story.created_at).toLocaleDateString();
    
    const readButton = document.createElement('a');
    readButton.href = `/story/${story.id}`;
    readButton.className = 'btn btn-sm btn-outline-info';
    readButton.textContent = 'Read More';
    
    footer.appendChild(date);
    footer.appendChild(readButton);
    
    cardBody.appendChild(title);
    cardBody.appendChild(author);
    cardBody.appendChild(content);
    
    card.appendChild(cardBody);
    card.appendChild(footer);
    
    col.appendChild(card);
    
    return col;
  }
</script>
{% endblock %}